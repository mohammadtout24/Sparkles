{% extends 'store/base.html' %}

{% block content %}

<div class="container" style="max-width: 600px; margin-top: 4rem;">
    <h2 class="section-title">Checkout</h2>

    <div style="background: white; padding: 2rem; border: 1px solid #ddd; border-radius: 8px;">

        <h3 id="total-display" style="text-align:center; color: var(--brand-gold);">
        Total: ${{ total_price }}
        </h3>

        <form method="POST">
    {% csrf_token %}

    <div style="margin-bottom: 15px;">
        <label>Full Name</label>
        <input type="text" name="name" required style="width: 100%; padding: 8px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label>Phone Number</label>
        <input type="tel" name="phone" required style="width: 100%; padding: 8px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label>Delivery Region</label>
        <select name="region" id="region-select" required style="width: 100%; padding: 8px;">
        <option value="" disabled selected>Select your location...</option>
        <option value="tripoli">Tripoli & Suburbs</option>
        <option value="north">Rest of North</option>
        <option value="other">Beirut, South, Chouf, Bekaa , ....</option>
        </select>
    </div>

    <div style="margin-bottom: 15px;">
        <label>City / Village Details</label>
        <input type="text" name="city" required placeholder="e.g. Mina, Damour, Zahle..." style="width: 100%; padding: 8px;">
    </div>

    <div style="margin-bottom: 20px;">
        <label>Address Details</label>
        <textarea name="address" rows="3" required placeholder="Street, Building, Floor..." style="width: 100%; padding: 8px;"></textarea>
    </div>

    <button type="submit" class="btn-view" style="width: 100%; background: var(--brand-navy); color: white; cursor: pointer;">
        Confirm Order
    </button>
</form>

    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the elements
        const regionSelect = document.getElementById('region-select');
        const totalDisplay = document.getElementById('total-display');
        
        // Get the initial subtotal from Django (products only)
        // We use parseFloat to treat it as a number
        const baseTotal = parseFloat("{{ total_price }}");

        // Listen for changes on the dropdown
        regionSelect.addEventListener('change', function() {
            let deliveryFee = 0;
            const selectedRegion = this.value;

            // Determine fee based on selection
            if (selectedRegion === 'tripoli') {
                deliveryFee = 3.00;
            } else if (selectedRegion === 'north') {
                deliveryFee = 4.00;
            } else if (selectedRegion === 'other') {
                deliveryFee = 5.00;
            }

            // Calculate new total
            const finalTotal = baseTotal + deliveryFee;

            // Update the text on screen (formatting to 2 decimal places)
            totalDisplay.textContent = `Total: $${finalTotal.toFixed(2)}`;
        });
    });
</script>
{% endblock %}
