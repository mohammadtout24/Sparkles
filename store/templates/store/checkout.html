{% extends 'store/base.html' %}
{% block content %}

<div class="container" style="margin-top: 4rem; max-width: 600px;">
    <h2 class="section-title">Checkout</h2>

    <form method="POST" style="background: white; padding: 2rem; border-radius: 8px; border: 1px solid #eee;">
        {% csrf_token %}

        <div style="margin-bottom: 15px;">
            <label>Full Name</label>
            <input type="text" name="name" required class="form-control" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label>Phone Number</label>
            <input type="tel" name="phone" required class="form-control" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label>City / Region</label>
            <input type="text" name="city" required class="form-control" style="width: 100%; padding: 10px; margin-top: 5px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label>Detailed Address</label>
            <textarea name="address" required rows="2" class="form-control" style="width: 100%; padding: 10px; margin-top: 5px;"></textarea>
        </div>

        <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
            <label style="font-weight: bold;">Select Delivery Location</label>
            <select name="delivery_region" id="deliverySelect" onchange="updateTotal()" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
                <option value="tripoli" data-cost="3">Tripoli & Suburbs (+$3.00)</option>
                <option value="north" data-cost="4">Rest of North (+$4.00)</option>
                <option value="other" data-cost="5">Beirut, South, Beqaa (+$5.00)</option>
            </select>
        </div>

        <div style="border-top: 1px solid #ddd; padding-top: 20px; margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Subtotal:</span>
                <span>${{ total_price|floatform:2 }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #666;">
                <span>Delivery:</span>
                <span id="deliveryDisplay">+$3.00</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; margin-top: 10px;">
                <span>Total:</span>
                <span id="finalTotal">${{ total_price|add:3|floatform:2 }}</span>
            </div>
        </div>

        <button type="submit" class="btn-view" style="width: 100%; background: var(--brand-navy); color: white; margin-top: 20px; padding: 15px;">
            Confirm Order
        </button>
    </form>
</div>

<script>
    function updateTotal() {
        // Get the base subtotal from Django (converted to JS float)
        var subtotal = parseFloat("{{ total_price }}");
        
        // Get selected delivery cost
        var select = document.getElementById('deliverySelect');
        var cost = parseFloat(select.options[select.selectedIndex].getAttribute('data-cost'));
        
        // Calculate total
        var total = subtotal + cost;
        
        // Update the display
        document.getElementById('deliveryDisplay').innerText = "+$" + cost.toFixed(2);
        document.getElementById('finalTotal').innerText = "$" + total.toFixed(2);
    }
</script>

{% endblock %}
